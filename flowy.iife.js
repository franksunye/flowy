!function(){"use strict";var e=function(t,i,l,r,d,o){function f(e){r(e)}i||(i=function(){}),l||(l=function(){}),r||(r=function(){}),d||(d=20),o||(o=80),$(document).ready(function(){var r="undefined"!=typeof BlockManager?new BlockManager:null,a=r?r.getAllBlocks():[],n=r?r.getTempBlocks():[],s=t;function p(){return r?r.getBlockCount():a.length}function c(e){r?(r.addBlock(e),a.push(e)):a.push(e)}function h(){r?(r.mergeTempBlocks(),a=r.getAllBlocks(),n=r.getTempBlocks()):(a=$.merge(a,n),n=[])}function v(e){r?(r.removeBlocks(function(t){return t.id!=e}),a=r.getAllBlocks()):a=$.grep(a,function(t){return t.id!=e})}var u,w,g,x,k=!1,b=d,m=o,C=0,y=0,L=!1,T=!1;function B(){C=a.map(e=>e.x);var e=a.map(e=>e.width),t=C.map(function(t,i){return t-e[i]/2});if((C=Math.min.apply(Math,t))<s.offset().left){T=!0;for(var i=a.map(e=>e.id),l=0;l<a.length;l++)if($(".blockid[value="+a.filter(e=>e.id==i[l])[0].id+"]").parent().css("left",a.filter(e=>e.id==i[l])[0].x-a.filter(e=>e.id==i[l])[0].width/2-C+20),-1!=a.filter(e=>e.id==i[l])[0].parent){var r=a.filter(e=>e.id==i[l])[0];r.x-a.filter(e=>e.id==a.filter(e=>e.id==i[l])[0].parent)[0].x<0?$(".arrowid[value="+i[l]+"]").parent().css("left",r.x-C+20-5+"px"):$(".arrowid[value="+i[l]+"]").parent().css("left",a.filter(e=>e.id==a.filter(e=>e.id==i[l])[0].parent)[0].x-20-C+20+"px")}for(l=0;l<a.length;l++)a[l].x=$(".blockid[value="+a[l].id+"]").parent().offset().left+s.offset().left-$(".blockid[value="+a[l].id+"]").parent().innerWidth()/2-40;y=C}}function H(){for(var e=a.map(e=>e.parent),t=0;t<e.length;t++){-1==e[t]&&t++;for(var i=0,l=0,r=0;r<a.filter(i=>i.parent==e[t]).length;r++){var d=a.filter(i=>i.parent==e[t])[r];0==a.filter(e=>e.parent==d.id).length&&(d.childwidth=0),d.childwidth>d.width?r==a.filter(i=>i.parent==e[t]).length-1?i+=d.childwidth:i+=d.childwidth+b:r==a.filter(i=>i.parent==e[t]).length-1?i+=d.width:i+=d.width+b}-1!=e[t]&&(a.filter(i=>i.id==e[t])[0].childwidth=i);for(r=0;r<a.filter(i=>i.parent==e[t]).length;r++){d=a.filter(i=>i.parent==e[t])[r];$(".blockid[value="+d.id+"]").parent().css("top",a.filter(i=>i.id==e[t]).y+m+"px"),a.filter(i=>i.id==e[t]).y=a.filter(i=>i.id==e[t]).y+m,d.childwidth>d.width?($(".blockid[value="+d.id+"]").parent().css("left",a.filter(i=>i.id==e[t])[0].x-i/2+l+d.childwidth/2-d.width/2-s.offset().left+"px"),d.x=a.filter(i=>i.id==e[t])[0].x-i/2+l+d.childwidth/2,l+=d.childwidth+b):($(".blockid[value="+d.id+"]").parent().css("left",a.filter(i=>i.id==e[t])[0].x-i/2+l-s.offset().left+"px"),d.x=a.filter(i=>i.id==e[t])[0].x-i/2+l+d.width/2,l+=d.width+b);var o=a.filter(e=>e.id==d.id)[0],f=o.x-a.filter(e=>e.id==d.parent)[0].x+20,n=o.y-o.height/2-(a.filter(e=>e.id==d.parent)[0].y+a.filter(e=>e.id==d.parent)[0].height/2);$(".arrowid[value="+d.id+"]").parent().css("top",a.filter(e=>e.id==d.parent)[0].y+a.filter(e=>e.id==d.parent)[0].height/2-s.offset().top+"px"),f<0?($(".arrowid[value="+d.id+"]").parent().css("left",o.x-5-s.offset().left+"px"),$(".arrowid[value="+d.id+"]").parent().html('<input type="hidden" class="arrowid" value="'+d.id+'"><svg preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M'+(a.filter(e=>e.id==d.parent)[0].x-o.x+5)+" 0L"+(a.filter(e=>e.id==d.parent)[0].x-o.x+5)+" "+m/2+"L5 "+m/2+"L5 "+n+'" stroke="#C5CCD0" stroke-width="2px"/><path d="M0 '+(n-5)+"H10L5 "+n+"L0 "+(n-5)+'Z" fill="#C5CCD0"/></svg>')):($(".arrowid[value="+d.id+"]").parent().css("left",a.filter(e=>e.id==d.parent)[0].x-20-s.offset().left+"px"),$(".arrowid[value="+d.id+"]").parent().html('<input type="hidden" class="arrowid" value="'+d.id+'"><svg preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 0L20 '+m/2+"L"+f+" "+m/2+"L"+f+" "+n+'" stroke="#C5CCD0" stroke-width="2px"/><path d="M'+(f-5)+" "+(n-5)+"H"+(f+5)+"L"+f+" "+n+"L"+(f-5)+" "+(n-5)+'Z" fill="#C5CCD0"/></svg>'))}}}s&&"function"==typeof s.append&&s.append("<div class='indicator invisible'></div>"),e.output=function(){var e=[];if(a.length>0){for(var t=0;t<a.length;t++)e.push({id:a[t].id,parent:a[t].parent,data:[]}),$(".blockid[value="+a[t].id+"]").parent().children("input").each(function(){var i=$(this).attr("name"),l=$(this).val();e[t].data.push({name:i,value:l})});return e}},e.deleteBlocks=function(){r?(r.clearBlocks(),a.length=0):a=[],s.html("<div class='indicator invisible'></div>")},$(document).on("mousedown",".create-flowy",function(e){if(1===e.which){if(x=$(this),0==p()){var t=p();$(this).clone().addClass("block").append("<input type='hidden' name='blockid' class='blockid' value='"+t+"'>").removeClass("create-flowy").appendTo("body"),$(this).addClass("dragnow"),u=$(".blockid[value="+t+"]").parent()}else{t=r?r.getNextBlockId():0===a.length?0:Math.max.apply(Math,a.map(e=>e.id))+1;$(this).clone().addClass("block").append("<input type='hidden' name='blockid' class='blockid' value='"+t+"'>").removeClass("create-flowy").appendTo("body"),$(this).addClass("dragnow"),u=$(".blockid[value="+t+"]").parent()}l=$(this),i(l),u.addClass("dragging"),k=!0,w=e.clientX-$(this).offset().left,g=e.clientY-$(this).offset().top,u.css("left",e.clientX-w+"px"),u.css("top",e.clientY-g+"px")}var l}),$(document).on("mouseup",function(e){if(1===e.which&&(k||L))if(l(),$(".indicator").hasClass("invisible")||$(".indicator").addClass("invisible"),k&&(x.removeClass("dragnow"),u.removeClass("dragging")),0==parseInt(u.children(".blockid").val())&&L){u.removeClass("dragging"),L=!1;for(var t=0;t<n.length;t++)n[t].id!=parseInt(u.children(".blockid").val())&&($(".blockid[value="+n[t].id+"]").parent().css("left",$(".blockid[value="+n[t].id+"]").parent().offset().left-s.offset().left+s.scrollLeft()),$(".blockid[value="+n[t].id+"]").parent().css("top",$(".blockid[value="+n[t].id+"]").parent().offset().top-s.offset().top+s.scrollTop()),$(".arrowid[value="+n[t].id+"]").parent().css("left",$(".arrowid[value="+n[t].id+"]").parent().offset().left-s.offset().left+s.scrollLeft()),$(".arrowid[value="+n[t].id+"]").parent().css("top",$(".arrowid[value="+n[t].id+"]").parent().offset().top-s.offset().top+s.scrollTop()+"px"),$(".blockid[value="+n[t].id+"]").parent().appendTo(s),$(".arrowid[value="+n[t].id+"]").parent().appendTo(s),n[t].x=$(".blockid[value="+n[t].id+"]").parent().offset().left+$(".blockid[value="+n[t].id+"]").innerWidth()/2+s.scrollLeft(),n[t].y=$(".blockid[value="+n[t].id+"]").parent().offset().top+$(".blockid[value="+n[t].id+"]").parent().innerHeight()/2+s.scrollTop());n.filter(e=>0==e.id)[0].x=u.offset().left+u.innerWidth()/2,n.filter(e=>0==e.id)[0].y=u.offset().top+u.innerHeight()/2,h()}else if(k&&0==a.length&&u.offset().top>s.offset().top&&u.offset().left>s.offset().left)f(u),k=!1,u.css("top",u.offset().top-s.offset().top+s.scrollTop()+"px"),u.css("left",u.offset().left-s.offset().left+s.scrollLeft()+"px"),u.appendTo(s),c({parent:-1,childwidth:0,id:parseInt(u.children(".blockid").val()),x:u.offset().left+u.innerWidth()/2+s.scrollLeft(),y:u.offset().top+u.innerHeight()/2+s.scrollTop(),width:u.innerWidth(),height:u.innerHeight()});else if(k&&0==a.length)u.remove();else if(k||L)for(var i=u.offset().left+u.innerWidth()/2+s.scrollLeft(),r=u.offset().top+s.scrollTop(),d=a.map(e=>e.id),o=0;o<a.length;o++){if(i>=a.filter(e=>e.id==d[o])[0].x-a.filter(e=>e.id==d[o])[0].width/2-b&&i<=a.filter(e=>e.id==d[o])[0].x+a.filter(e=>e.id==d[o])[0].width/2+b&&r>=a.filter(e=>e.id==d[o])[0].y-a.filter(e=>e.id==d[o])[0].height/2&&r<=a.filter(e=>e.id==d[o])[0].y+a.filter(e=>e.id==d[o])[0].height){k=!1,L||(f(u),u.appendTo(s));var p=0,v=0;for(t=0;t<a.filter(e=>e.parent==d[o]).length;t++){(M=a.filter(e=>e.parent==d[o])[t]).childwidth>M.width?p+=M.childwidth+b:p+=M.width+b}p+=u.innerWidth();for(t=0;t<a.filter(e=>e.parent==d[o]).length;t++){(M=a.filter(e=>e.parent==d[o])[t]).childwidth>M.width?($(".blockid[value="+M.id+"]").parent().css("left",a.filter(e=>e.id==d[o])[0].x-p/2+v+M.childwidth/2-M.width/2+"px"),M.x=a.filter(e=>e.parent==d[o])[0].x-p/2+v+M.childwidth/2,v+=M.childwidth+b):($(".blockid[value="+M.id+"]").parent().css("left",a.filter(e=>e.id==d[o])[0].x-p/2+v+"px"),M.x=a.filter(e=>e.parent==d[o])[0].x-p/2+v+M.width/2,v+=M.width+b)}if(u.css("left",a.filter(e=>e.id==d[o])[0].x-p/2+v-s.offset().left+s.scrollLeft()+"px"),u.css("top",a.filter(e=>e.id==d[o])[0].y+a.filter(e=>e.id==d[o])[0].height/2+m-s.offset().top+"px"),L){n.filter(e=>e.id==parseInt(u.children(".blockid").val()))[0].x=u.offset().left+u.innerWidth()/2+s.scrollLeft()+s.scrollLeft(),n.filter(e=>e.id==parseInt(u.children(".blockid").val()))[0].y=u.offset().top+u.innerHeight()/2+s.scrollTop(),n.filter(e=>e.id==u.children(".blockid").val())[0].parent=d[o];for(t=0;t<n.length;t++)n[t].id!=parseInt(u.children(".blockid").val())&&($(".blockid[value="+n[t].id+"]").parent().css("left",$(".blockid[value="+n[t].id+"]").parent().offset().left-s.offset().left+s.scrollLeft()),$(".blockid[value="+n[t].id+"]").parent().css("top",$(".blockid[value="+n[t].id+"]").parent().offset().top-s.offset().top+s.scrollTop()),$(".arrowid[value="+n[t].id+"]").parent().css("left",$(".arrowid[value="+n[t].id+"]").parent().offset().left-s.offset().left+s.scrollLeft()+20),$(".arrowid[value="+n[t].id+"]").parent().css("top",$(".arrowid[value="+n[t].id+"]").parent().offset().top-s.offset().top+s.scrollTop()),$(".blockid[value="+n[t].id+"]").parent().appendTo(s),$(".arrowid[value="+n[t].id+"]").parent().appendTo(s),n[t].x=$(".blockid[value="+n[t].id+"]").parent().offset().left+$(".blockid[value="+n[t].id+"]").innerWidth()/2+s.scrollLeft(),n[t].y=$(".blockid[value="+n[t].id+"]").parent().offset().top+$(".blockid[value="+n[t].id+"]").parent().innerHeight()/2+s.scrollTop());h()}else c({childwidth:0,parent:d[o],id:parseInt(u.children(".blockid").val()),x:u.offset().left+u.innerWidth()/2+s.scrollLeft(),y:u.offset().top+u.innerHeight()/2+s.scrollTop(),width:u.innerWidth(),height:u.innerHeight()});var w=a.filter(e=>e.id==parseInt(u.children(".blockid").val()))[0],g=w.x-a.filter(e=>e.id==d[o])[0].x+20,C=w.y-w.height/2-(a.filter(e=>e.parent==d[o])[0].y+a.filter(e=>e.parent==d[o])[0].height/2)+s.scrollTop();if(g<0?(u.after('<div class="arrowblock"><input type="hidden" class="arrowid" value="'+u.children(".blockid").val()+'"><svg preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M'+(a.filter(e=>e.id==d[o])[0].x-w.x+5)+" 0L"+(a.filter(e=>e.id==d[o])[0].x-w.x+5)+" "+m/2+"L5 "+m/2+"L5 "+C+'" stroke="#C5CCD0" stroke-width="2px"/><path d="M0 '+(C-5)+"H10L5 "+C+"L0 "+(C-5)+'Z" fill="#C5CCD0"/></svg></div>'),$(".arrowid[value="+u.children(".blockid").val()+"]").parent().css("left",w.x-5-s.offset().left+s.scrollLeft()+"px")):(u.after('<div class="arrowblock"><input type="hidden" class="arrowid" value="'+u.children(".blockid").val()+'"><svg preserveaspectratio="none" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 0L20 '+m/2+"L"+g+" "+m/2+"L"+g+" "+C+'" stroke="#C5CCD0" stroke-width="2px"/><path d="M'+(g-5)+" "+(C-5)+"H"+(g+5)+"L"+g+" "+C+"L"+(g-5)+" "+(C-5)+'Z" fill="#C5CCD0"/></svg></div>'),$(".arrowid[value="+parseInt(u.children(".blockid").val())+"]").parent().css("left",a.filter(e=>e.id==d[o])[0].x-20-s.offset().left+s.scrollLeft()+"px")),$(".arrowid[value="+parseInt(u.children(".blockid").val())+"]").parent().css("top",a.filter(e=>e.id==d[o])[0].y+a.filter(e=>e.id==d[o])[0].height/2+"px"),-1!=a.filter(e=>e.id==d[o])[0].parent){for(var y=!1,T=d[o];!y;)if(-1==a.filter(e=>e.id==T)[0].parent)y=!0;else{var I=0;for(t=0;t<a.filter(e=>e.parent==T).length;t++){var M;(M=a.filter(e=>e.parent==T)[t]).childwidth>M.width?t==a.filter(e=>e.parent==T).length-1?I+=M.childwidth:I+=M.childwidth+b:t==a.filter(e=>e.parent==T).length-1?I+=M.width:I+=M.width+b}a.filter(e=>e.id==T)[0].childwidth=I,T=a.filter(e=>e.id==T)[0].parent}a.filter(e=>e.id==T)[0].childwidth=p}L&&(L=!1,u.removeClass("dragging")),H(),B();break}o==a.length-1&&(L&&(L=!1,n=[]),k=!1,u.remove())}}),$(document).on("mousedown",".block",function(e){$(document).on("mouseup mousemove",".block",function e(t){if("mouseup"!==t.type&&1===t.which&&!k&&!L){L=!0,(u=$(this)).addClass("dragging"),w=t.clientX-$(this).offset().left,g=t.clientY-$(this).offset().top;var i=parseInt($(this).children(".blockid").val());u=$(this),n.push(a.filter(e=>e.id==i)[0]),v(i),$(".arrowid[value="+i+"]").parent().remove();for(var l=a.filter(e=>e.parent==i),r=!1,d=[],o=[];!r;){for(var f=0;f<l.length;f++)n.push(a.filter(e=>e.id==l[f].id)[0]),$(".blockid[value="+l[f].id+"]").parent().css("left",$(".blockid[value="+l[f].id+"]").parent().offset().left-u.offset().left),$(".blockid[value="+l[f].id+"]").parent().css("top",$(".blockid[value="+l[f].id+"]").parent().offset().top-u.offset().top),$(".arrowid[value="+l[f].id+"]").parent().css("left",$(".arrowid[value="+l[f].id+"]").parent().offset().left-u.offset().left),$(".arrowid[value="+l[f].id+"]").parent().css("top",$(".arrowid[value="+l[f].id+"]").parent().offset().top-u.offset().top),$(".blockid[value="+l[f].id+"]").parent().appendTo(u),$(".arrowid[value="+l[f].id+"]").parent().appendTo(u),d.push(l[f].id),o.push(l[f].id);0==d.length?r=!0:(l=a.filter(e=>d.includes(e.parent)),d=[])}for(f=0;f<a.filter(e=>e.parent==i).length;f++){v(a.filter(e=>e.parent==i)[f])}for(f=0;f<o.length;f++){v(o[f])}a.length>1&&H(),T&&function(){if(y<s.offset().left){T=!1;for(var e=a.map(e=>e.id),t=0;t<a.length;t++)if($(".blockid[value="+a.filter(i=>i.id==e[t])[0].id+"]").parent().css("left",a.filter(i=>i.id==e[t])[0].x-a.filter(i=>i.id==e[t])[0].width/2-y-20),a.filter(i=>i.id==e[t])[0].x=$(".blockid[value="+a.filter(i=>i.id==e[t])[0].id+"]").parent().offset().left+a.filter(i=>i.id==e[t])[0].width/2,-1!=a.filter(i=>i.id==e[t])[0].parent){var i=a.filter(i=>i.id==e[t])[0];i.x-a.filter(i=>i.id==a.filter(i=>i.id==e[t])[0].parent)[0].x<0?$(".arrowid[value="+e[t]+"]").parent().css("left",i.x-5-s.offset().left+"px"):$(".arrowid[value="+e[t]+"]").parent().css("left",a.filter(i=>i.id==a.filter(i=>i.id==e[t])[0].parent)[0].x-20-s.offset().left+"px")}for(t=0;t<a.length;t++);y=0}}()}$(document).off("mouseup mousemove",e)})}),$(document).on("mousemove",function(e){if(k?(u.css("left",e.clientX-w+"px"),u.css("top",e.clientY-g+"px")):L&&(u.css("left",e.clientX-w-s.offset().left+s.scrollLeft()+"px"),u.css("top",e.clientY-g-s.offset().top+s.scrollTop()+"px"),n.filter(e=>e.id==parseInt(u.children(".blockid").val())).x=u.offset().left+u.innerWidth()/2+s.scrollLeft(),n.filter(e=>e.id==parseInt(u.children(".blockid").val())).y=u.offset().left+u.innerHeight()/2+s.scrollTop()),k||L)for(var t=u.offset().left+u.innerWidth()/2+s.scrollLeft(),i=u.offset().top+s.scrollTop(),l=a.map(e=>e.id),r=0;r<a.length;r++){if(t>=a.filter(e=>e.id==l[r])[0].x-a.filter(e=>e.id==l[r])[0].width/2-b&&t<=a.filter(e=>e.id==l[r])[0].x+a.filter(e=>e.id==l[r])[0].width/2+b&&i>=a.filter(e=>e.id==l[r])[0].y-a.filter(e=>e.id==l[r])[0].height/2&&i<=a.filter(e=>e.id==l[r])[0].y+a.filter(e=>e.id==l[r])[0].height){$(".indicator").appendTo($(".blockid[value="+l[r]+"]").parent()),$(".indicator").css("left",$(".blockid[value="+l[r]+"]").parent().innerWidth()/2-5+"px"),$(".indicator").css("top",$(".blockid[value="+l[r]+"]").parent().innerHeight()+"px"),$(".indicator").removeClass("invisible");break}r==a.length-1&&($(".indicator").hasClass("invisible")||$(".indicator").addClass("invisible"))}})})};"undefined"!=typeof module&&module.exports&&(module.exports=e)}();
//# sourceMappingURL=flowy.iife.js.map
