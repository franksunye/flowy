# VERIFICATION_CHECKLIST.md - 重构验证清单

## 🎯 验证目标
确保重构后功能完全一致，性能不降级，API完全兼容。

## 📋 验证清单

### ✅ 自动化测试验证

#### 1. 单元测试 (必须100%通过)
```bash
npm run test:unit
```
**期望结果**:
- ✅ 83个测试全部通过
- ✅ 0个测试失败
- ✅ 执行时间 < 10秒

#### 2. 端到端测试
```bash
npm run test:e2e
```
**期望结果**:
- ✅ 所有E2E测试通过
- ✅ 拖拽功能正常
- ✅ 吸附机制正常

#### 3. 代码覆盖率
```bash
npm run test:coverage
```
**期望结果**:
- ✅ 覆盖率 ≥ 当前水平 (7.72%)
- ✅ 无新的未覆盖代码

### 🖱️ 手动Demo验证

#### 开发服务器启动
```bash
npm run dev
# 访问: http://localhost:3000/
```

#### 核心功能验证

##### 1. 拖拽创建功能
- [ ] **拖拽开始块** 🚀 到画布
  - 期望: 在画布中创建新块
  - 期望: 触发 onGrab 回调
- [ ] **拖拽处理块** ⚙️ 到画布
  - 期望: 在画布中创建新块
- [ ] **拖拽判断块** ❓ 到画布
  - 期望: 在画布中创建新块
- [ ] **拖拽结束块** 🏁 到画布
  - 期望: 在画布中创建新块

##### 2. 吸附连接功能
- [ ] **块与块吸附**
  - 拖拽一个块靠近另一个块
  - 期望: 显示吸附指示器
  - 期望: 自动吸附到正确位置
  - 期望: 触发 onSnap 回调

##### 3. 块重新排列功能
- [ ] **拖拽已存在的块**
  - 在画布中拖拽已创建的块
  - 期望: 块可以移动
  - 期望: 可以重新吸附到其他块

##### 4. 数据导出功能
- [ ] **点击"📄 导出工作流"按钮**
  - 期望: 显示JSON格式的工作流数据
  - 期望: 数据结构正确
  - 期望: 包含所有块的信息

##### 5. 清空功能
- [ ] **点击"🗑️ 清空画布"按钮**
  - 期望: 所有块被删除
  - 期望: 画布恢复空白状态
  - 期望: 导出数据为空

### 🔧 API兼容性验证

#### 浏览器控制台测试
打开浏览器开发者工具，在控制台执行：

```javascript
// 1. 验证flowy函数存在
console.log('flowy函数:', typeof flowy);
// 期望: "function"

// 2. 验证API方法存在
console.log('output方法:', typeof flowy.output);
console.log('deleteBlocks方法:', typeof flowy.deleteBlocks);
// 期望: 都是 "function"

// 3. 测试output方法
const data = flowy.output();
console.log('导出数据:', data);
// 期望: undefined (空画布) 或 数组 (有块时)

// 4. 测试deleteBlocks方法
flowy.deleteBlocks();
console.log('清空后数据:', flowy.output());
// 期望: undefined
```

### 📊 性能验证

#### 1. 拖拽响应性
- [ ] **拖拽流畅度**
  - 拖拽块时应该流畅跟随鼠标
  - 无明显延迟或卡顿

#### 2. 吸附响应性
- [ ] **吸附检测速度**
  - 吸附指示器应该及时显示/隐藏
  - 吸附位置计算应该实时

#### 3. 内存使用
- [ ] **无内存泄漏**
  - 多次拖拽后内存使用稳定
  - 清空画布后内存释放

### 🐛 边界条件验证

#### 1. 异常操作
- [ ] **快速连续拖拽**
  - 快速拖拽多个块
  - 期望: 不出现异常状态

- [ ] **拖拽到画布外**
  - 将块拖拽到画布边界外
  - 期望: 块被正确处理（删除或回弹）

#### 2. 数据一致性
- [ ] **复杂工作流**
  - 创建包含多个块的复杂工作流
  - 导出数据应该完整准确

### 📝 验证记录模板

```
重构阶段: [模块名称]
验证时间: [YYYY-MM-DD HH:MM]
验证人员: [姓名]

自动化测试:
□ 单元测试: ___/83 通过
□ E2E测试: 通过/失败
□ 覆盖率: ___%

手动验证:
□ 拖拽创建: 正常/异常
□ 吸附连接: 正常/异常  
□ 重新排列: 正常/异常
□ 数据导出: 正常/异常
□ 清空功能: 正常/异常

API验证:
□ flowy函数: 正常/异常
□ output方法: 正常/异常
□ deleteBlocks方法: 正常/异常

性能验证:
□ 拖拽流畅度: 正常/异常
□ 吸附响应性: 正常/异常
□ 内存使用: 正常/异常

问题记录:
[如有问题，详细描述]

验证结论:
□ 通过 - 可以继续下一步
□ 失败 - 需要回滚修复
```

## 🚨 失败处理流程

如果任何验证失败：

1. **立即停止** 当前重构步骤
2. **记录问题** 详细描述失败现象
3. **回滚代码** 恢复到上一个稳定状态
4. **分析原因** 找出失败根本原因
5. **调整策略** 修改重构方法
6. **重新验证** 确保回滚后功能正常
7. **重新开始** 采用新策略重新重构

## 🎯 验证频率

- **每个模块提取后**: 完整验证
- **每个小改动后**: 快速验证（自动化测试）
- **每日结束前**: 完整验证
- **最终集成后**: 全面验证

---

**维护者**: 重构团队  
**创建时间**: 2025-07-21  
**版本**: 1.0
